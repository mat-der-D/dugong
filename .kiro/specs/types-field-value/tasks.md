# 実装タスク: types-field-value

## タスク一覧

- [ ] 1. フィールド値の統一インターフェース（FieldValue）の定義と全テンソル型への実装
- [ ] 1.1 FieldValue の共通インターフェースを定義する
  - フィールド値として使用できる型が持つべき共通演算（加算・減算・スカラー倍・符号反転）をスーパートレイトバウンドとして宣言する
  - 加法単位元を返す静的メソッドと、ユークリッド/フロベニウスノルムを返すインスタンスメソッドをトレイトに追加する
  - すべての公開トレイトアイテムに数学的な意味・ゼロ元の保証・ノルムの種別を説明するドキュメントコメントを付与する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 5.3_

- [ ] 1.2 すべてのテンソル型に FieldValue を実装する
  - `f64` はゼロ元として `0.0`、ノルムとして絶対値を返すよう実装する
  - `Vector` はゼロ元として全成分ゼロのベクトルを、ノルムとして L2 ノルム（√(x²+y²+z²)）を返すよう実装する
  - `Tensor`（9 成分）はゼロ元として全成分ゼロのテンソルを、ノルムとしてフロベニウスノルムを返すよう実装する
  - `SymmTensor`（6 成分）はゼロ元として全成分ゼロの対称テンソルを、ノルムとして対称性を考慮したフロベニウスノルム（対角外成分を係数 2 で計上）を返すよう実装する
  - `SphericalTensor` はゼロ元として `new(0.0)` を、ノルムとして `√3 · |s|` を返すよう実装する
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [ ] 2. 微分演算子の出力型をコンパイル時に決定するランク昇降 trait の定義
- [ ] 2.1 (P) 勾配演算子の出力型を決定する HasGrad trait を定義し実装する
  - 勾配演算子の出力型を関連型として持つトレイトを定義し、出力型が `FieldValue` を実装することをコンパイル時に保証する
  - スカラー値の勾配がベクトル値（`f64 → Vector`）になるよう関連型を設定する
  - ベクトル値の勾配がテンソル値（`Vector → Tensor`）になるよう関連型を設定する
  - すべての公開トレイトアイテムにドキュメントコメントを付与する
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 5.3_

- [ ] 2.2 (P) 発散演算子の出力型を決定する HasDiv trait を定義し実装する
  - 発散演算子の出力型を関連型として持つトレイトを定義し、出力型が `FieldValue` を実装することをコンパイル時に保証する
  - ベクトル値の発散がスカラー値（`Vector → f64`）になるよう関連型を設定する
  - テンソル値の発散がベクトル値（`Tensor → Vector`）になるよう関連型を設定する
  - 対称テンソル値の発散がベクトル値（`SymmTensor → Vector`）になるよう関連型を設定する
  - すべての公開トレイトアイテムにドキュメントコメントを付与する
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 5.3_

- [ ] 3. traits モジュールの組み立てとクレートルートからの公開 API 整備
  - `traits` サブモジュールを新設し、3 つのトレイトファイルをまとめてモジュールとして集約する
  - `lib.rs` から `traits` モジュールを公開し、3 つのトレイトをクレートルートから直接インポートできるよう再エクスポートする
  - _Requirements: 5.1, 5.2_

- [ ] 4. テストによる数値的正確さと型安全性の保証
- [ ] 4.1 (P) FieldValue 実装の数値テストを追加する
  - 全 5 型のゼロ元のノルムが `1e-14` 未満であることを確認するテストを各型に追加する
  - `Vector::new(3.0, 4.0, 0.0)` のノルムが `5.0` に対して相対誤差 `1e-14` 以内であることを確認するテストを追加する
  - `SymmTensor` の対角外成分の係数 2 倍が正しく計算されていることを確認するテストを追加する
  - `SphericalTensor::new(1.0)` のノルムが `√3` に近いことを確認するテストを追加する
  - _Requirements: 1.4, 1.5, 2.6_

- [ ] 4.2 (P) HasGrad / HasDiv の型レベルテストと compile_fail テストを追加する
  - `<f64 as HasGrad>::GradOutput` が `Vector` であることを型アノテーションで確認するテストを追加する
  - `<Vector as HasGrad>::GradOutput` が `Tensor` であることを確認するテストを追加する
  - `<Vector as HasDiv>::DivOutput` が `f64`、`<Tensor as HasDiv>::DivOutput` が `Vector`、`<SymmTensor as HasDiv>::DivOutput` が `Vector` であることを確認するテストを追加する
  - `SymmTensor` が `HasGrad` を実装しないことを `compile_fail` doctest で検証する
  - `f64` が `HasDiv` を実装しないことを `compile_fail` doctest で検証する
  - _Requirements: 3.4, 3.5, 4.5, 4.6_

- [ ] 4.3 ビルド・静的解析・全テスト通過を確認する
  - `cargo build -p dugong-types` がエラーなしで完了することを確認する
  - `cargo clippy -p dugong-types` が警告ゼロであることを確認する（警告が出た場合は修正する）
  - `cargo test -p dugong-types` が全テストパスすることを確認する
  - _Requirements: 5.4, 5.5, 5.6_
